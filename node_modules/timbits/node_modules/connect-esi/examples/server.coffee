connect = require 'connect'
express = require 'express'
connectESI = require '../src/connect-esi'

server = connect.createServer()

server.use connectESI.setupESI()
server.use express.static("#{process.cwd()}")

server.use (req, res, next) ->
	body = ''
	switch req.url
		when '/hello' then body = 'HELLO WORLD!'
		when '/hello&esi_id=esi_0&remote=true' then body = 'jQuery("#esi_0").html("hello world! (csi /hello success)");'
		when '/hello.html&esi_id=esi_1&remote=true' then body = 'jQuery("#esi_1").html("hello world! (csi /hello.html success)");'
		else
			body = 'File or path not found.'
			res.statusCode = 404
	res.write body
	res.end()
 
server.listen 5678

console.log "Server running at " + server.address().address + " on port " + server.address().port
console.log "cwd: " + process.cwd() + "\n"